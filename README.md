# Biochar-Estimate
A lite image segmentation model to calculate volume of char in a container

## Table of Contents

- [Problem Statement](#Problem-Statement)
- [Solution](#Our-solution)
- [Segmentation Model](#Segmentation-Model)
- [Volume Calculation](#Volume-Calculation)
- [Acknowledgements](#Acknowledgements)


## Problem Statement
[Varaha](https://www.varaha.earth/) is a leading global climate tech startup that specializes in nature-based solutions, including regenerative agriculture, agroforestry, and biochar projects that promote climate adaptation, biodiversity, water conservation and increased income for smallholder land stewards. Their project involved pyrolysis of wild invasisve plants to produce biochar. Snce this pyrolysis is carried in special large containers quantifying the volume of char produced was difficult using only manual labour. So an automation tool was need to carry this quantification.

## Our solution
We developed a Computer Vision model based on [this model](https://www.sciencedirect.com/science/article/abs/pii/S0927025621005383?via%3Dihub) for our segmentation task. We added an attetion layer on top of the existing model for a better segmentation. Next after the container and biochar is detected we calculate the volume in two different ways using simple geometry and ANN.
<p align="center">
  <img src="https://github.com/old-school-kid/biochar-estimate/blob/main/demo/2.jpg" alt="Image 1" width="200"/>
</p>

## Segmentation Model
I published a paper in Computational Materials Science,   where we developed a smaller model to detect microstructure types. We used this model as encoder and designed an exact inverse of encoder for the decoder making both of them mirror image of each other. We also introduced a Attention Layer in the last block of encoder and vis-a-vis the first block of decoder to capture a wider context of features. The output is a 2 channel mask for biochar and the container in context.
The segmentation model still works even when there is a pixel blockage by the biochar or manual intervention as we are using Attention that captures a wider context of features.
<p align="center">
  <img src="https://github.com/old-school-kid/biochar-estimate/blob/main/demo/55.jpg" alt="Image 1" width="200"/>
  <img src="https://github.com/old-school-kid/biochar-estimate/blob/main/demo/57.jpg" alt="Image 2" width="200"/>
  <img src="https://github.com/old-school-kid/biochar-estimate/blob/main/demo/101.jpg" alt="Image 3" width="200"/>
</p>

## Volume Calculation
We have two ways of calculating volume.
1. Geomentry.
   We consider the container to be a truncated cone and calculate the volume by finding the major and minor axes length of the open and close sides. Then we calculate percentage of the container that is filled up by char by checking the point where the biochar contour intersects the major axis of the open side of the conatiner.
2. ANN
   Calculation of volume using geometry is deterministic way and shouldnt raise a problem in ideal world. But often we observe that container is disfigured or the char is filled very much or less in and around the major axis of the ellipse, ie the open face of the container. So we develop a shallow neural network to predict the volume of char from the latent that is generated by the encoder of the segmentation model.

## Acknowledgements
I am thankful to [Shaurya Sharma](https://www.linkedin.com/in/shaurya-sharma-705980157/) for his belief in me and providing me an oppurtunity to work on this interesting use-case.

